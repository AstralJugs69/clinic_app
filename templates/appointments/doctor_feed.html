{% extends "base.html" %}
{% block content %}

<div class="max-w-6xl mx-auto px-4 py-6 space-y-5">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-semibold">Doctor Live Feed</h1>
      <p class="text-sm text-gray-500">Accept checked-in patients and send them to the next room.</p>
    </div>
    <div class="flex gap-2 flex-wrap">
      <a href="{% url 'appointments:frontdesk_feed' %}" class="px-3 py-2 border rounded hover:bg-gray-50 text-sm">Front Desk</a>
      {% for room_item in rooms %}
      <a href="{% url 'appointments:room_feed' room_item.code %}" class="px-3 py-2 border rounded hover:bg-gray-50 text-sm">{{ room_item.name }}</a>
      {% endfor %}
    </div>
  </div>

  <div class="grid md:grid-cols-2 gap-5">
    <div class="bg-white shadow rounded p-4">
      <h2 class="text-lg font-semibold mb-3">Waiting for Doctor</h2>
      <div class="space-y-3">
        {% for item in waiting_doctor %}
        <div class="border rounded p-3 flex items-center justify-between gap-3">
          <div>
            <p class="font-medium">{{ item.patient.full_name }}</p>
            <p class="text-sm text-gray-500">{{ item.scheduled_at|date:"H:i" }} · {{ item.reason|default:"No reason" }}</p>
          </div>
          <form method="post" action="{% url 'appointments:doctor_accept' item.id %}">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.get_full_path }}" />
            <button type="submit" class="bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700">Accept</button>
          </form>
        </div>
        {% empty %}
        <p class="text-sm text-gray-500">No patients waiting for doctor.</p>
        {% endfor %}
      </div>
    </div>

    <div class="bg-white shadow rounded p-4">
      <h2 class="text-lg font-semibold mb-3">With Doctor</h2>
      <div class="space-y-3">
        {% for item in with_doctor %}
        <div class="border rounded p-3 space-y-2">
          <div>
            <p class="font-medium">{{ item.patient.full_name }}</p>
            <p class="text-sm text-gray-500">{{ item.scheduled_at|date:"H:i" }} · {{ item.reason|default:"No reason" }}</p>
          </div>
          <form method="post" action="{% url 'appointments:transfer_to_room' item.id %}" class="flex items-center gap-2">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.get_full_path }}" />
            <select name="room_id" class="border rounded px-2 py-1.5 text-sm flex-1" required>
              <option value="">Select room</option>
              {% for room_item in rooms %}
              <option value="{{ room_item.id }}">{{ room_item.name }}</option>
              {% endfor %}
            </select>
            <button type="submit" class="bg-amber-600 text-white px-3 py-1.5 rounded hover:bg-amber-700">Send</button>
          </form>
        </div>
        {% empty %}
        <p class="text-sm text-gray-500">No patients currently with doctor.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

{% include "appointments/_live_socket.html" %}
{% endblock %}
